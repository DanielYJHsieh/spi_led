# ESP8266 SPI aRGB LED 控制程式 (18 LED UART控制版)

## 專案概述
這是一個基於ESP8266 WeMos D1 Mini的SPI aRGB LED控制程式，使用UART接口設定LED顏色。本版本支援18顆LED，預設全白燈模式，可透過串口命令個別控制每顆LED的RGB值。

## 主要功能
- **18顆LED控制**: 支援更多LED數量的高效控制
- **UART命令介面**: 使用簡單的文字命令設置LED顏色
- **實時反饋**: 命令處理提供清晰的執行狀態回饋
- **預設白燈模式**: 啟動時自動設定所有LED為白色
- **標準SPI傳輸**: 使用硬體SPI提高傳輸穩定性與效率

## 硬體需求
- **主控板**: ESP8266 WeMos D1 Mini
- **測試工具**: 邏輯分析儀 (Logic Analyzer，可選)
- **目標設備**: WS2812B aRGB LED燈條
- **UART連接**: 可透過Serial Monitor或其他UART裝置進行控制

## 硬體連接
```
ESP8266 WeMos D1 Mini → WS2812B LED燈條
├── D7 (GPIO13) MOSI → LED Data In
├── 5V            → LED VCC  
└── GND           → LED GND

ESP8266 WeMos D1 Mini → 邏輯分析儀(選配)
├── D7 (GPIO13) MOSI → CH0
├── D5 (GPIO14) SCK  → CH1
└── GND           → GND
```

## SPI配置
- **頻率**: 3.33MHz (ESP8266精確支援)
- **模式**: SPI_MODE0 (CPOL=0, CPHA=0)
- **位元順序**: MSBFIRST
- **數據長度**: 216位元組 (18顆LED × 12位元組/LED)

## aRGB LED協議編碼
程式實現WS2812B單線協議的SPI模擬，使用精確時序：
- **Logic 0**: `1000` (300ns High + 900ns Low) → 0x8
- **Logic 1**: `1110` (900ns High + 300ns Low) → 0xE
- **Reset Code**: >50µs 低電平 (傳輸完成後自動生成)

## UART命令系統

### 基本命令格式
- **設置單一LED**: `LED索引,R值,G值,B值` (例如: `0,255,0,0`)
- **LED索引範圍**: 0-17 (共18顆LED)
- **RGB值範圍**: 0-255 (0x00-0xFF)

### 特殊命令
- **test**: 測試UART通訊連接
- **status**: 顯示所有LED當前狀態
- **help**: 顯示可用命令列表
- **reset**: 重設所有LED為白色

### 回應格式
- **成功執行**: 顯示 `處理命令:`, `設置LED X 為 RGB(R,G,B)`, `LED顯示已更新`
- **錯誤提示**: 顯示具體錯誤原因

## 使用說明

### 基本設置
1. 將程式上傳到ESP8266 WeMos D1 Mini
2. 打開Serial Monitor (波特率: 115200)
3. 連接LED燈條到D7(GPIO13)
4. 輸入命令控制LED顏色

### 命令範例
```
test          # 測試UART通訊
help          # 顯示可用命令
status        # 查看所有LED狀態
reset         # 重設所有LED為白色

# 單一LED控制範例
0,255,0,0     # 第1顆LED設為紅色
1,0,255,0     # 第2顆LED設為綠色
2,0,0,255     # 第3顆LED設為藍色
5,255,255,0   # 第6顆LED設為黃色
10,128,0,128  # 第11顆LED設為紫色
17,0,255,255  # 第18顆LED設為青色
```

### 邏輯分析儀設定 (選配)
- **取樣率**: 100MHz以上
- **觸發**: MOSI上升沿
- **解碼協議**: SPI (CPOL=0, CPHA=0)
- **觀察重點**: 216位元組連續傳輸和時序穩定性

## 技術特性
- **高精度時序**: ESP8266的3.33MHz SPI頻率與WS2812B要求高度匹配
- **單次大塊傳輸**: 使用`SPI.writeBytes()`實現連續數據傳輸，避免時序抖動
- **8位到32位轉換**: 將每個顏色位元自動轉換為4位元的時序編碼
- **動態記憶體管理**: 根據LED數量自動分配適當的緩衝區大小

## 性能參數
- **每LED數據量**: 12位元組 (每色RGB各4位元組)
- **總數據傳輸**: 18顆LED × 12位元組 = 216位元組
- **單次更新時間**: 約0.5ms (不含重置時間)
- **命令響應時間**: <5ms

## 注意事項
- 使用外部電源供應器連接LED燈條時，確保共地連接
- 18顆全亮白燈電流消耗可達1A以上，請使用足夠電流的電源
- 長燈條應考慮在燈條中間加電以防電壓降
- 燈條與ESP8266之間的連線應盡量短且粗，減少信號衰減
- 可通過Arduino IDE導出HEX檔案用於批量部署
